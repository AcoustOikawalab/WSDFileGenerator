(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function o(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(a){if(a.ep)return;a.ep=!0;const d=o(a);fetch(a.href,d)}})();let m;function le(e){const n=typeof e;if(n=="number"||n=="boolean"||e==null)return`${e}`;if(n=="string")return`"${e}"`;if(n=="symbol"){const a=e.description;return a==null?"Symbol":`Symbol(${a})`}if(n=="function"){const a=e.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(e)){const a=e.length;let d="[";a>0&&(d+=le(e[0]));for(let f=1;f<a;f++)d+=", "+le(e[f]);return d+="]",d}const o=/\[object ([^\]]+)\]/.exec(toString.call(e));let l;if(o&&o.length>1)l=o[1];else return toString.call(e);if(l=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:l}function Ge(e,n){return e=e>>>0,k().subarray(e/1,e/1+n)}let A=null;function ke(){return(A===null||A.buffer.detached===!0||A.buffer.detached===void 0&&A.buffer!==m.memory.buffer)&&(A=new DataView(m.memory.buffer)),A}function ae(e,n){return e=e>>>0,Ze(e,n)}let P=null;function k(){return(P===null||P.byteLength===0)&&(P=new Uint8Array(m.memory.buffer)),P}function Fe(e,n){const o=n(e.length*1,1)>>>0;return k().set(e,o/1),I=e.length,o}function ce(e,n,o){if(o===void 0){const g=$.encode(e),h=n(g.length,1)>>>0;return k().subarray(h,h+g.length).set(g),I=g.length,h}let l=e.length,a=n(l,1)>>>0;const d=k();let f=0;for(;f<l;f++){const g=e.charCodeAt(f);if(g>127)break;d[a+f]=g}if(f!==l){f!==0&&(e=e.slice(f)),a=o(a,l,l=f+e.length*3,1)>>>0;const g=k().subarray(a+f,a+l),h=$.encodeInto(e,g);f+=h.written,a=o(a,l,f,1)>>>0}return I=f,a}function de(e){const n=m.__wbindgen_externrefs.get(e);return m.__externref_table_dealloc(e),n}let j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});j.decode();const Qe=2146435072;let ie=0;function Ze(e,n){return ie+=n,ie>=Qe&&(j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),j.decode(),ie=n),j.decode(k().subarray(e,e+n))}const $=new TextEncoder;"encodeInto"in $||($.encodeInto=function(e,n){const o=$.encode(e);return n.set(o),{read:e.length,written:o.length}});let I=0;function et(e){const n=Fe(e,m.__wbindgen_malloc),o=I,l=m.get_file_metadata_wasm(n,o);if(l[2])throw de(l[1]);return de(l[0])}function re(e,n,o){const l=Fe(e,m.__wbindgen_malloc),a=I,d=ce(n,m.__wbindgen_malloc,m.__wbindgen_realloc),f=I,g=ce(o,m.__wbindgen_malloc,m.__wbindgen_realloc),h=I,v=m.process_audio_wasm(l,a,d,f,g,h);if(v[3])throw de(v[2]);var T=Ge(v[0],v[1]).slice();return m.__wbindgen_free(v[0],v[1]*1,1),T}const tt=new Set(["basic","cors","default"]);async function nt(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(l){if(e.ok&&tt.has(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",l);else throw l}const o=await e.arrayBuffer();return await WebAssembly.instantiate(o,n)}else{const o=await WebAssembly.instantiate(e,n);return o instanceof WebAssembly.Instance?{instance:o,module:e}:o}}function st(){const e={};return e.wbg={},e.wbg.__wbg___wbindgen_debug_string_adfb662ae34724b6=function(n,o){const l=le(o),a=ce(l,m.__wbindgen_malloc,m.__wbindgen_realloc),d=I;ke().setInt32(n+4,d,!0),ke().setInt32(n+0,a,!0)},e.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(n,o){throw new Error(ae(n,o))},e.wbg.__wbg_log_96687ca918cef030=function(n,o){console.log(ae(n,o))},e.wbg.__wbg_new_1ba21ce319a06297=function(){return new Object},e.wbg.__wbg_set_3f1d0b984ed272ed=function(n,o,l){n[o]=l},e.wbg.__wbindgen_cast_2241b6af4c4b2941=function(n,o){return ae(n,o)},e.wbg.__wbindgen_init_externref_table=function(){const n=m.__wbindgen_externrefs,o=n.grow(4);n.set(0,void 0),n.set(o+0,void 0),n.set(o+1,null),n.set(o+2,!0),n.set(o+3,!1)},e}function ot(e,n){return m=e.exports,De.__wbindgen_wasm_module=n,A=null,P=null,m.__wbindgen_start(),m}async function De(e){if(m!==void 0)return m;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL(""+new URL("wsd_logic_bg-DaiwkVNI.wasm",import.meta.url).href,import.meta.url));const n=st();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:o,module:l}=await nt(await e,n);return ot(o,l)}document.addEventListener("DOMContentLoaded",async()=>{try{await De(),console.log("Wasm (Rust) initialized successfully!")}catch(t){console.error("Wasm initialization failed:",t),alert("Wasmã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`wasm-pack build --target web` ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã‹ï¼Ÿ")}const e=document.getElementById("audioFileInput"),n=document.getElementById("fileSelectBtn"),o=document.getElementById("processButton"),l=document.getElementById("statusMessage"),a=document.getElementById("downloadLink"),d=document.getElementById("dropArea"),f=document.getElementById("dropContent"),g=document.getElementById("fileListContent"),h=document.getElementById("fileList"),v=document.getElementById("addMoreBtn"),T=document.querySelectorAll(".tab"),ue=document.querySelector(".tab-slider"),fe=document.getElementById("backBtnMeta"),me=document.getElementById("homeBtnMeta"),ge=document.getElementById("backBtnAudio"),ye=document.getElementById("homeBtnAudio"),U=document.getElementById("helpModal"),Oe=document.getElementById("modalTitle"),Re=document.getElementById("modalText"),We=document.getElementById("closeModal"),Ne=document.querySelectorAll(".help-icon"),H=document.getElementById("mainScreen"),F=document.getElementById("metadataScreen"),D=document.getElementById("skipMetadata"),O=document.querySelectorAll(".metadata-input"),V=document.getElementById("processWithMetadata"),J=document.getElementById("metadataStatusMessage"),K=document.getElementById("metadataDownloadLink"),X=document.getElementById("audioParamsScreen"),qe=document.getElementById("processWithAudioParams"),R=document.getElementById("audioParamsStatusMessage"),Y=document.getElementById("audioParamsDownloadLink"),pe=document.getElementById("channelConfigList"),be=document.getElementById("binSettings"),he=document.getElementById("audioSettings"),G=document.getElementById("currentSampleRate"),Q=document.getElementById("samplingFrequency"),W=document.getElementById("customSamplingFrequency");document.getElementById("channelCountDisplay");const Pe=document.getElementById("channelCount");let u=[],E=null,w="bin";const _=new Map,$e={1:["cf"],2:["lf","rf"],3:["lf","cf","rf"],4:["lf","rf","lr","rr"],5:["lf","rf","cf","lr","rr"],6:["lf","rf","cf","lfe","lr","rr"]},Z=[{value:"lf",label:"Lf"},{value:"lf-middle",label:"Lf-m"},{value:"cf",label:"Cf"},{value:"rf-middle",label:"Rf-m"},{value:"rf",label:"Rf"},{value:"lr",label:"Lr"},{value:"lr-middle",label:"Lr-m"},{value:"cr",label:"Cr"},{value:"rr-middle",label:"Rr-m"},{value:"rr",label:"Rr"},{value:"lfe",label:"LFE"}],Ue={main:{title:"æœ¬ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦",text:`ãƒ–ãƒ©ã‚¦ã‚¶å®Œçµåž‹ã®WSDãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆå¤‰æ›ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Rust + WebAssembly ã‚’ä½¿ç”¨ã—ã€ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã‚ãšã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å¤‰æ›å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚`},bin:{title:"binãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦",text:`ãƒ˜ãƒƒãƒ€ãƒ¼ç„¡ã—ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’WSDã«å¤‰æ›ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

ãƒãƒ£ãƒ³ãƒãƒ«ã”ã¨ã«åˆ†å‰²ã•ã‚ŒãŸãƒ¢ãƒŽãƒ©ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°é¸æŠžã—ã€WSDä»•æ§˜ã«åŸºã¥ã„ã¦å¤‰æ›ã—ã¾ã™ã€‚
â€»æ¨™æœ¬åŒ–å‘¨æ³¢æ•°ãƒ»ãƒãƒ£ãƒ³ãƒãƒ«é…ç½®ã®æ‰‹å‹•è¨­å®šãŒå¿…è¦ã§ã™ã€‚`},"audio-high":{title:"DSDéŸ³æºã«ã¤ã„ã¦",text:`DSF / DSDIFFã‚’WSDã«å¤‰æ›ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è§£æžã—ã€1bitãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†ã®ã¿ã‚’æŠ½å‡ºã—ã¦WSDåŒ–ã—ã¾ã™ã€‚
ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•å–å¾—ã•ã‚Œã‚‹ãŸã‚ã€æ‰‹å‹•è¨­å®šã¯ä¸è¦ã§ã™ã€‚`},"audio-common":{title:"PCMéŸ³æºã«ã¤ã„ã¦",text:"æœªå¯¾å¿œ"}};window.addEventListener("resize",()=>{setTimeout(()=>window.scrollTo(0,0),100)}),window.addEventListener("orientationchange",()=>{setTimeout(()=>window.scrollTo(0,0),500)}),"ontouchstart"in window&&(document.body.style.webkitOverflowScrolling="touch");function ze(t){const s=Ue[t];s&&requestAnimationFrame(()=>{Oe.textContent=s.title,Re.textContent=s.text,U.style.display="block",document.body.style.overflow="hidden"})}function ee(){requestAnimationFrame(()=>{U.style.display="none",document.body.style.overflow="auto"})}Ne.forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation(),s.preventDefault();const i=t.dataset.help;requestAnimationFrame(()=>ze(i))},{passive:!1})}),We.addEventListener("click",ee),U.addEventListener("click",t=>{t.target===U&&ee()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&ee()});let we;function Ee(){clearTimeout(we),we=setTimeout(()=>{const t=document.querySelector(".tab.active");if(!t)return;const s=Array.from(T).indexOf(t),i=100/T.length,r=s*100;requestAnimationFrame(()=>{ue.style.width=`${i}%`,ue.style.transform=`translateX(${r}%)`})},16)}Ee(),T.forEach(t=>{t.addEventListener("click",s=>{s.target.classList.contains("help-icon")||s.target.classList.contains("tab-help")||t.classList.contains("active")||t.classList.contains("disabled")||requestAnimationFrame(()=>{T.forEach(i=>i.classList.remove("active")),t.classList.add("active"),w=t.dataset.tab,Ee(),ve(),te(),w==="audio-high"?o.textContent="å‡¦ç†ã‚’é–‹å§‹":o.textContent="æ¬¡ã«é€²ã‚€"})},{passive:!0})});function ve(){const t={bin:".bin","audio-high":".dsf, .dff","audio-common":".wav, .aif"};e.accept=t[w]||".bin, .dsf, .dff, .aif, .wav",w==="bin"?e.multiple=!0:e.multiple=!1,u.length>0&&(u.every(Le)?w!=="bin"&&u.length>1&&(u=[u[0]],z()):te())}function te(){u=[],_.clear(),E=null,e.value="",z(),o.disabled=!0,l.textContent="",a.style.display="none",f.style.display="flex",g.style.display="none"}n.addEventListener("click",()=>e.click()),v.addEventListener("click",()=>e.click()),d.addEventListener("dragover",t=>{t.preventDefault(),d.classList.add("dragover")}),d.addEventListener("dragleave",t=>{t.preventDefault(),d.classList.remove("dragover")}),d.addEventListener("drop",t=>{t.preventDefault(),d.classList.remove("dragover");const s=Array.from(t.dataTransfer.files);s.length>0&&_e(s)});function Le(t){const s=t.name.toLowerCase();return({bin:[".bin"],"audio-high":[".dsf",".dff"],"audio-common":[".wav, .aif"]}[w]||[]).some(c=>s.endsWith(c.replace(" ","")))}e.addEventListener("change",t=>{t.target.files&&t.target.files.length>0&&_e(Array.from(t.target.files)),e.value=""});function _e(t){const s=t.filter(Le);if(s.length===0){l.textContent="é¸æŠžã•ã‚ŒãŸã‚¿ãƒ–ã«å¯¾å¿œã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚";return}w==="bin"?u.push(...s):(u=[s[0]],_.clear()),Se(),z()}function Se(){if(w!=="bin")return;const t=u.length,s=$e[t]||[];_.clear(),u.forEach((i,r)=>{let c="lf";r<s.length?c=s[r]:r<Z.length&&(c=Z[r].value),_.set(i,c)}),ne()}function je(t){if(t===0)return"0 B";const s=1024,i=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,r)).toFixed(2))+" "+i[r]}function z(){if(h.innerHTML="",u.length===0){l.textContent="ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚",o.disabled=!0,a.style.display="none",E=null,f.style.display="flex",g.style.display="none";return}f.style.display="none",g.style.display="flex",w!=="bin"?h.classList.add("single-mode"):h.classList.remove("single-mode"),u.forEach((t,s)=>{const i=document.createElement("div");i.className="file-item";const r=document.createElement("div");r.className="file-item-icon",r.textContent="ðŸŽµ";const c=document.createElement("div");c.className="file-info";const y=document.createElement("span");y.className="file-name",y.textContent=w==="bin"?`${s+1}. ${t.name}`:t.name;const b=document.createElement("span");b.className="file-size",b.textContent=`(${je(t.size)})`,c.appendChild(y),c.appendChild(b);const p=document.createElement("div");p.className="remove-btn",p.innerHTML="&times;",p.title="å‰Šé™¤",p.onclick=()=>{u.splice(s,1),_.delete(t),Se(),z()},i.appendChild(r),i.appendChild(c),i.appendChild(p),h.appendChild(i)}),w!=="bin"&&u.length>=1?v.style.display="none":v.style.display="block",u.length===1?l.textContent="ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã™ (1ä»¶)":l.textContent=`${u.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠžã•ã‚Œã¦ã„ã¾ã™`,o.disabled=!1,a.style.display="none",E=u[0],Be()}function Be(){if(!E)return;const t="."+E.name.split(".").pop().toLowerCase();if(be.style.display="none",he.style.display="none",t===".bin"){be.style.display="block";const s=u.length>0?u.length:1;Pe.value=s,pe.innerHTML="",u.forEach((i,r)=>{const c=document.createElement("div");c.className="file-item",c.style.marginBottom="0.5vh",c.style.padding="0.5vh";const y=document.createElement("div");y.className="file-info";const b=document.createElement("span");b.className="file-name",b.textContent=`${r+1}. ${i.name}`,b.style.fontSize="0.9rem",y.appendChild(b);const p=document.createElement("select");p.className="channel-select",Z.forEach(S=>{const B=document.createElement("option");B.value=S.value,B.textContent=S.label,_.get(i)===S.value&&(B.selected=!0),p.appendChild(B)}),p.addEventListener("change",S=>{_.set(i,S.target.value),ne()}),c.appendChild(y),c.appendChild(p),pe.appendChild(c)}),ne()}else[".wav",".aif"].includes(t)&&(he.style.display="block",G.value=44100,G.readOnly=!1)}async function He(t){if(!t)return;const s="."+t.name.split(".").pop().toLowerCase();if([".dsf",".dff"].includes(s))try{const i=new Uint8Array(await t.arrayBuffer()),r=et(i);r&&r.hasData&&(console.log("ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºæˆåŠŸ:",r),r.title&&(document.getElementById("title").value=r.title),r.artist&&(document.getElementById("artist").value=r.artist),r.album&&(document.getElementById("album").value=r.album),r.composer&&(document.getElementById("composer").value=r.composer),r.genre&&(document.getElementById("genre").value=r.genre),r.dateTime&&(document.getElementById("recordDate").value=r.dateTime),D.checked=!1,O.forEach(c=>{c.disabled=!1,c.classList.remove("input-warning")}),l.textContent="ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚")}catch(i){console.warn("ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå¤±æ•—:",i)}}function ne(){document.querySelectorAll('#binSettings input[type="checkbox"]').forEach(s=>s.checked=!1),u.forEach(s=>{const i=_.get(s);if(i){const r=document.querySelector(`#binSettings input[value="${i}"]`);r&&(r.checked=!0)}})}Q&&Q.addEventListener("change",t=>{t.target.value==="other"?(W.style.display="block",W.required=!0):(W.style.display="none",W.required=!1)}),o.addEventListener("click",async()=>{if(u.length===0){l.textContent="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«é¸æŠžã—ã¦ãã ã•ã„ã€‚";return}w==="audio-high"?await Ve():Je()});async function Ve(){o.disabled=!0,l.textContent="å‡¦ç†ä¸­ã§ã™...",a.style.display="none";try{const t=u[0],s=new Uint8Array(await t.arrayBuffer()),i=JSON.stringify({}),r=JSON.stringify({}),c=re(s,i,r),y=new Blob([c],{type:"application/octet-stream"}),b=URL.createObjectURL(y);a.href=b,a.download=`processed_${t.name.replace(/\.[^/.]+$/,"")}.wsd`,a.click(),l.textContent="å‡¦ç†å®Œäº†ï¼"}catch(t){console.error(t);const s=typeof t=="string"?t:t.message;l.textContent="ã‚¨ãƒ©ãƒ¼: "+s}finally{o.disabled=!1}}async function Je(){E&&await He(E),window.scrollTo(0,0),requestAnimationFrame(()=>{H.classList.add("slide-left"),setTimeout(()=>{F.classList.add("show")},150),setTimeout(()=>{window.scrollTo(0,0)},300)})}function Ke(){window.scrollTo(0,0),Be(),requestAnimationFrame(()=>{F.classList.remove("show"),setTimeout(()=>{X.classList.add("show")},150),setTimeout(()=>{window.scrollTo(0,0)},300)})}D.addEventListener("change",()=>{const t=D.checked;O.forEach(s=>{s.disabled=t,t&&(s.value="",s.classList.remove("input-warning"))})}),qe.addEventListener("click",async()=>{if(u.length===0)return;const t=u[0],s="."+t.name.split(".").pop().toLowerCase();R.textContent="å‡¦ç†ä¸­...";const i={};let r=null;try{if(s===".bin"){const C=Q.value;i.samplingFrequency=parseInt(C==="other"?W.value:C,10);const N=u.length;i.channelCount=N;const oe=new Map;let Ie=!1;if(u.forEach(L=>{const q=_.get(L);q?oe.set(q,L):Ie=!0}),Ie){R.textContent="ã‚¨ãƒ©ãƒ¼: ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šãŒã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚";return}const Ye=["lf","lf-middle","cf","rf-middle","rf","lfe","lr","lr-middle","cr","rr-middle","rr"],M=[],xe=[];for(const L of Ye)oe.has(L)&&(M.push(oe.get(L)),xe.push(L));if(M.length!==N){R.textContent=`ã‚¨ãƒ©ãƒ¼: ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šã«é‡è¤‡ãŒã‚ã‚‹ã‹ã€ç„¡åŠ¹ãªæ§‹æˆã§ã™ã€‚(ãƒ•ã‚¡ã‚¤ãƒ«æ•°:${N}, æœ‰åŠ¹è¨­å®š:${M.length})`;return}i.inputFileCount=M.length,i.channelLayout=xe;let Ae=0;for(const L of M)Ae+=L.size;const Te=new Uint8Array(Ae);let Me=0;for(const L of M){const q=new Uint8Array(await L.arrayBuffer());Te.set(q,Me),Me+=q.length}r=Te}else r=new Uint8Array(await t.arrayBuffer()),[".wav",".aif"].includes(s)&&(i.samplingMultiplier=document.getElementById("samplingMultiplier").value,i.currentSampleRate=G.value);const c={},y={title:"title",composer:"composer",lyricist:"songWriter",artist:"artist",album:"album",genre:"genre",recordDate:"dateTime",recordLocation:"location",comment:"comment",other:"userSpecific"};D.checked||O.forEach(C=>{if(!C.disabled&&C.value.trim()){const N=y[C.id]||C.id;c[N]=C.value.trim()}});const b=JSON.stringify(c),p=JSON.stringify(i);console.log("Rustã¸é€ä¿¡:",p);const S=re(r,b,p),B=new Blob([S],{type:"application/octet-stream"}),x=window.URL.createObjectURL(B),se=t.name.replace(/\.[^/.]+$/,"");Y.href=x,Y.download=`processed_${se}.wsd`,Y.click(),R.textContent="å‡¦ç†å®Œäº†ï¼"}catch(c){console.error("Processing error:",c);const y=typeof c=="string"?c:c.message;R.textContent="ã‚¨ãƒ©ãƒ¼: "+y}}),V.addEventListener("click",async()=>{if(!E)return;const t="."+E.name.split(".").pop().toLowerCase();if([".bin",".wav",".aif"].includes(t)){Ke();return}J.textContent="å‡¦ç†ä¸­...",V.disabled=!0;try{const i={},r={title:"title",composer:"composer",lyricist:"songWriter",artist:"artist",album:"album",genre:"genre",recordDate:"dateTime",recordLocation:"location",comment:"comment",other:"userSpecific"};D.checked||O.forEach(x=>{if(!x.disabled&&x.value.trim()){const se=r[x.id]||x.id;i[se]=x.value.trim()}});const c=new Uint8Array(await E.arrayBuffer()),y=JSON.stringify(i),b=JSON.stringify({}),p=re(c,y,b),S=new Blob([p],{type:"application/octet-stream"}),B=URL.createObjectURL(S);K.href=B,K.download=`processed_${E.name.replace(/\.[^/.]+$/,"")}.wsd`,K.click(),J.textContent="Rustã«ã‚ˆã‚‹å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼"}catch(i){console.error("Processing error:",i),J.textContent="ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+i}finally{V.disabled=!1}});function Xe(t){return/^[\x20-\x7E]*$/.test(t)}O.forEach(t=>{t.addEventListener("input",s=>{const i=s.target.value;Xe(i)?s.target.classList.remove("input-warning"):s.target.classList.add("input-warning")})}),ve(),fe&&fe.addEventListener("click",()=>{requestAnimationFrame(()=>{F.classList.remove("show"),setTimeout(()=>{H.classList.remove("slide-left"),window.scrollTo(0,0)},300)})}),ge&&ge.addEventListener("click",()=>{requestAnimationFrame(()=>{X.classList.remove("show"),setTimeout(()=>{F.classList.add("show"),window.scrollTo(0,0)},150)})});function Ce(){requestAnimationFrame(()=>{X.classList.remove("show"),F.classList.remove("show"),setTimeout(()=>{H.classList.remove("slide-left"),te(),window.scrollTo(0,0)},300)})}me&&me.addEventListener("click",Ce),ye&&ye.addEventListener("click",Ce)});
